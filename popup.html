<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tabby ðŸ˜¸</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      width: 300px;
      padding: 10px;
      margin: 0;
      box-sizing: border-box;
    }

    h1 {
      font-size: 18px;
      margin: 10px 0;
    }

    h2 {
      font-size: 16px;
      margin: 10px 0;
    }

    /* Search Input */
    .search-container {
      position: relative;
      margin-bottom: 10px;
    }

    .search-input {
      width: 100%;
      padding: 5px 30px 5px 10px;
      font-size: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .search-input:focus {
      border-color: #4a90e2;
      outline: none;
    }

    .search-icon {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 14px;
      color: #888;
      pointer-events: none;
    }

    /* Stats Section */
    .stats {
      margin-bottom: 15px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 5px 0;
    }

    .stat-label {
      font-weight: 600;
    }

    .stat-value {
      font-weight: normal;
    }

    hr {
      border: none;
      border-top: 1px solid #ddd;
      margin: 10px 0;
    }

    /* Buttons */
    button {
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #357abd;
    }

    /* Domain Table */
    #domainTable {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      table-layout: fixed; /* Ensures the column widths are fixed */
    }

    #domainTable th, #domainTable td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    #domainTable td:nth-child(2) {
      text-align: center; /* Center the numbers in the Value column */
    }

    #domainTable th {
      background-color: #f5f5f5;
      font-weight: 600;
      cursor: pointer;
    }

    #domainTable th:hover {
      background-color: #e0e0e0;
    }

    #domainTable th.sorted {
      color: #4a90e2;
    }

    #domainTable tr:hover {
      background-color: #f9f9f9;
    }

    #domainTable tr.clickable:hover {
      background-color: #f9f9f9;
      cursor: pointer; /* Added to show clickable cursor on hover */
    }
    
    .domain-cell {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .domain-cell img {
      width: 16px;
      height: 16px;
    }

    .domain-name {
      white-space: nowrap;         /* Prevents text from wrapping to a new line */
      overflow: hidden;            /* Hides content that exceeds the container */
      text-overflow: ellipsis;     /* Adds "..." to truncated text */
      flex: 1;                     /* Allows the span to take remaining space in flex container */
      min-width: 0;                /* Ensures the span can shrink below its content size */
    }

    /* Sort Arrows */
    .sort-arrow {
      width: 12px;
      height: 12px;
      vertical-align: middle;
      margin-left: 4px;
    }

    /* Ensure header text and icon stay on one line */
    #domainHeader {
      width: 60%;
      white-space: nowrap;
    }

    #valueHeader {
      width: 40%;
      white-space: nowrap;
    }

    /* Domain Chart */
    #domainChart {
      margin-top: 15px;
      height: 200px;
    }

    /* Tab View */
    #tabList ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #tabList li {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background-color 0.2s, box-shadow 0.2s;
      cursor: pointer;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #tabList li:hover {
      background-color: #f0f0f0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    /* Search View */
    #searchResults .panel {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background-color 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    #searchResults .panel:hover {
      background-color: #f0f0f0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    #searchResults .panel-title {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #searchResults .panel-match {
      font-size: 11px;
      color: #555;
    }

    #searchResults .highlight {
      background-color: #f8e71c;
      padding: 0;
      border-radius: 2px;
    }

    /* View Handling */
    #domainView, #tabView, #searchView {
      display: none;
    }

    #domainView.active, #tabView.active, #searchView.active {
      display: block;
    }

    #tabList, #searchResults {
      max-height: 250px;
      overflow-y: auto;
      padding: 5px;
    }

    .button-group {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
    }
  </style>
  <!-- SVG Definitions -->
  <svg width="0" height="0" style="position: absolute;">
    <defs>
      <!-- Alphabetical Sort Icons for Domain -->
      <symbol id="sort-alpha-ascending" viewBox="0 0 16 16">
        <path fill="currentColor" fill-rule="evenodd" d="M4.338 12.274V1.91h1v10.363L7 10.749l.676.737l-2.838 2.603L2 11.486l.676-.737zM10.628 2h1.744l.981 3.271l.02.051a23 23 0 0 1 .29.796c.08.232.161.487.223.72c.058.216.114.465.114.662h-1c0-.053-.022-.187-.08-.404a11 11 0 0 0-.203-.655a20 20 0 0 0-.181-.506h-2.072c-.053.142-.117.319-.181.506c-.076.222-.15.453-.203.655c-.058.217-.08.351-.08.404H9c0-.197.056-.446.114-.663c.062-.232.143-.487.223-.719a22 22 0 0 1 .29-.796l.02-.05zm.164 2.935h1.416L11.628 3h-.256zM9 9h5v1.25L10.333 13H14v1H9v-1.25L12.667 10H9z" clip-rule="evenodd"/>
      </symbol>
      <symbol id="sort-alpha-descending" viewBox="0 0 16 16">
        <path fill="currentColor" fill-rule="evenodd" d="M4.338 12.274V1.91h1v10.363L7 10.749l.676.737l-2.838 2.603L2 11.486l.676-.737zM9 2h4.5v1.207L10.207 6.5H13.5v1H9V6.293L12.293 3H9zm1.662 6.5h1.21l1 3.336l.02.047a20 20 0 0 1 .281.767c.077.224.156.471.216.698c.057.212.111.455.111.652h-1a2 2 0 0 0-.077-.395a10 10 0 0 0-.196-.63c-.06-.175-.12-.341-.17-.475h-1.952c-.07.141-.16.325-.25.52a8 8 0 0 0-.259.624q-.052.145-.076.246l-.017.08L9.5 14h-1c0-.22.079-.48.154-.69a9 9 0 0 1 .291-.705a17 17 0 0 1 .377-.77l.024-.045zm-.123 3h1.189l-.51-1.7z" clip-rule="evenodd"/>
      </symbol>
      <!-- Numerical Sort Icons for Value -->
      <symbol id="sort-descending" viewBox="0 0 16 16">
        <path fill="currentColor" fill-rule="evenodd" d="M10.954 12.274V1.91h1v10.363l1.662-1.525l.676.737l-2.838 2.603l-2.838-2.603l.676-.737zM7.708 4.16h-6v-1h6zm0 3h-5v-1h5zm0 3h-4v-1h4zm0 3h-3v-1h3z" clip-rule="evenodd"/>
      </symbol>
      <symbol id="sort-ascending" viewBox="0 0 16 16">
        <path fill="currentColor" fill-rule="evenodd" d="m11.454 1.91l2.838 2.604l-.676.737l-1.662-1.525V14.09h-1V3.726L9.292 5.251l-.676-.737zM7.708 4.16h-3v-1h3zm0 3h-4v-1h4zm0 3h-5v-1h5zm0 3h-6v-1h6z" clip-rule="evenodd"/>
      </symbol>
      <!-- Search Icon -->
      <symbol id="search-icon" viewBox="0 0 16 16">
        <path fill="currentColor" fill-rule="evenodd" d="M14 4H2V3h12zM9.456 6.005a2.451 2.451 0 1 0 0 4.902a2.451 2.451 0 0 0 0-4.902m-3.451 2.45a3.451 3.451 0 1 1 6.219 2.062l1.717 1.716l-.708.707l-1.716-1.716a3.451 3.451 0 0 1-5.512-2.768M5 8.5H2v-1h3zM6 13H2v-1h4z" clip-rule="evenodd"/>
      </symbol>
    </defs>
  </svg>
</head>
<body>
  <div class="search-container">
    <input type="text" id="searchInput" class="search-input" placeholder="Search tabs...">
    <svg class="search-icon"><use href="#search-icon"></use></svg>
  </div>
  <h1>Tabby ðŸ˜¸</h1>
  <div class="stats">
    <p class="stat-item"><span class="stat-label">Open windows:</span> <span id="openWindows" class="stat-value"></span></p>
    <p class="stat-item"><span class="stat-label">Open tabs:</span> <span id="openTabs" class="stat-value"></span></p>
    <p class="stat-item"><span class="stat-label">Current window tabs:</span> <span id="currentWindowTabs" class="stat-value"></span></p>
    <p class="stat-item"><span class="stat-label">All-time tabs:</span> <span id="allTimeTabs" class="stat-value"></span> <button id="resetAllTime">Reset</button></p>
    <p class="stat-item"><span class="stat-label">Max concurrent tabs:</span> <span id="maxConcurrent" class="stat-value"></span> <button id="resetMaxConcurrent">Reset</button></p>
  </div>
  <hr>
  <h2 id="viewTitle">Domain Breakdown</h2>
  <div id="domainView" class="active">
    <div class="button-group">
      <button id="toggleMode">Switch to Proportions</button>
    </div>
    <table id="domainTable">
      <thead>
        <tr>
          <th id="domainHeader" title="Click to sort by domain">Domain <span id="domainArrow"></span></th>
          <th id="valueHeader" title="Click to sort by value">Value <span id="valueArrow"></span></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <canvas id="domainChart"></canvas>
  </div>
  <div id="tabView">
    <div class="button-group">
      <button id="backToDomains">Back to Domains</button>
      <button id="toggleTabSort">Sort by Last Accessed</button>
    </div>
    <div id="tabList"></div>
  </div>
  <div id="searchView">
    <div id="searchResults"></div>
  </div>
  <script src="popup.js"></script>
</body>
</html>